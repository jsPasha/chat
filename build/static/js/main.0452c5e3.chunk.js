(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{114:function(e,t,a){e.exports={InputWrap:"Input_InputWrap__1Oh3w",FormGroup:"Input_FormGroup__dHXan"}},116:function(e,t,a){e.exports={Search:"Search_Search__1UqHE",Autocomplete:"Search_Autocomplete__3tVN_",Suggestions:"Search_Suggestions__RZcAg"}},117:function(e,t,a){e.exports={Item:"RoomItem_Item__37k_n",Active:"RoomItem_Active__1neyn",NotRead:"RoomItem_NotRead__13fFl"}},118:function(e,t,a){e.exports={Menu:"Profile_Menu__2mluK",Profile:"Profile_Profile__3agOE",active:"Profile_active__12t4K"}},142:function(e,t,a){e.exports={Container:"ChatBody_Container__35hNP",Preview:"ChatBody_Preview__2RE8A"}},143:function(e,t,a){e.exports={Wrapper:"Layout_Wrapper__ExLx6",App:"Layout_App__2PNTY"}},198:function(e,t,a){e.exports={Spinner:"Spinner_Spinner__3rQJ8"}},208:function(e,t,a){e.exports={Sidebar:"Sidebar_Sidebar__3TdYm"}},210:function(e,t,a){e.exports={Room:"Room_Room__4h6i7"}},213:function(e,t,a){e.exports={Body:"Chat_Body__3gWvU"}},215:function(e,t,a){e.exports={Header:"Header_Header__19x8R"}},219:function(e,t,a){e.exports=a(443)},224:function(e,t,a){},275:function(e,t){},39:function(e,t,a){e.exports={IsOwner:"Message_IsOwner__3zz94",Body:"Message_Body__1owYx",Message:"Message_Message__1VYvD",Status:"Message_Status__MQWiX",Sending:"Message_Sending__2F68P",NotReadBlock:"Message_NotReadBlock__3BasI",Content:"Message_Content__3aCXk",Owner:"Message_Owner__2r8f2",Time:"Message_Time__KLZNs"}},443:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),o=a(32),i=a.n(o);a(224),Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var s=a(16),c=a(11),l=a(23),u=a(24),m=a(26),d=a(25),p=a(27),h=a(21),f=a.n(h),g=a(36),E=a(8),_=a(195),v=a.n(_).a.create({baseURL:"/api",withCredentials:!0});v.defaults.withCredentials=!0;var S=v,O=function(e){return Object(E.a)({type:"INITIALIZE_SUCCESS"},e)},b=a(196),I=a.n(b),R=null,C=function(e){var t=e.room;return function(e,a){var n,r=a().chat,o=t._id;if(r.rooms.some(function(e,t){return n=t,e._id===o}))return e(w({index:n}));e(T({room:t}))}},y=function(e){var t=e.activeRoomIndex;return function(e,a){var n=a().chat.rooms[t],r=n._id,o=n.notRead;R.emit("read messages",{roomId:r,notRead:o}),e({type:"READ_MESSAGES",activeRoomIndex:t})}},w=function(e){var t=e.index;return function(e){e({type:"OPEN_ROOM",activeRoomIndex:{index:t}.index}),e(j())}},j=function(){return function(e,t){var a=t().chat,n=a.rooms,r=a.activeRoomIndex,o=n[r].messages,i=n[r]._id;e(o?y({activeRoomIndex:r}):function(e){var t=e.roomId;return function(){var e=Object(g.a)(f.a.mark(function e(a,n){var r,o,i;return f.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=n().chat.activeRoomIndex,a({type:"FETCH_MESSAGES_START"}),e.next=4,S.get("/messages?id=".concat(t),{withCredentials:!0});case 4:if("ERROR"!==(o=e.sent).data.status){e.next=7;break}return e.abrupt("return",console.log(o.data.message));case 7:i=o.data.messages,a({type:"FETCH_MESSAGES_SUCCESS",messages:i}),a(y({activeRoomIndex:r}));case 10:case"end":return e.stop()}},e,this)}));return function(t,a){return e.apply(this,arguments)}}()}({roomId:i}))}},T=function(e){return{type:"CREATE_ROOM",room:e.room}},A=a(45),x=a.n(A),k=a(100),N=a.n(k),M=a(101),P=a.n(M),L=a(197),U=a.n(L),z=function(e){function t(){var e,a;Object(l.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(m.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={open:!0},a.handleClickOpen=function(){a.setState({open:!0})},a.handleClose=function(){a.setState({open:!1})},a}return Object(p.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.props.message;return r.a.createElement("div",null,r.a.createElement(N.a,{open:this.state.open,onClose:this.handleClose,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description"},r.a.createElement(U.a,{id:"alert-dialog-title"},e),r.a.createElement(P.a,null,r.a.createElement(x.a,{onClick:this.handleClose,color:"primary",autoFocus:!0},"Close"))))}}]),t}(r.a.Component),F=a(200),D=a.n(F),H=a(201),q=a.n(H),G=a(202),B=a.n(G),W=function(e){return function(){var t=Object(g.a)(f.a.mark(function t(a){var n,r;return f.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return a({type:"FETCH_PROFILE_START"}),t.next=3,S.get("/user?id=".concat(e));case 3:n=t.sent,r=n.data.info,a({type:"FETCH_PROFILE_SUCCESS",info:r});case 6:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()},Z=a(199),K=a.n(Z),Y=a(198),X=a.n(Y),J=function(){return r.a.createElement("div",{className:X.a.Spinner},r.a.createElement(K.a,null))},Q=function(e){function t(){var e,a;Object(l.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(m.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).handleClose=function(){(0,a.props.close)()},a.handleOpenRoom=function(){var e=a.props,t=e.close,n=e.openRoom;t(),n({userId:a.props.profileInfo.id})},a}return Object(p.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.props,t=e.fullScreen,a=e.fetching;return r.a.createElement("div",null,r.a.createElement(N.a,{fullScreen:t,open:!0,onClose:this.handleClose,"aria-labelledby":"responsive-dialog-title"},r.a.createElement(D.a,null,a?r.a.createElement(J,null):r.a.createElement(n.Fragment,null,r.a.createElement(q.a,null,"email: ",this.props.profileInfo.email))),!a&&r.a.createElement(P.a,null,r.a.createElement(x.a,{onClick:this.handleClose,color:"primary"},"Close"),r.a.createElement(x.a,{onClick:this.handleOpenRoom,color:"primary",autoFocus:!0},"Chat"))))}}]),t}(r.a.Component),V=Object(c.b)(function(e){return{profileInfo:e.profile.info,fetching:e.profile.fetching}},function(e){return{close:function(){return e({type:"CLOSE_PROFILE"})},openRoom:function(t){var a=t.userId;return e(function(e){var t=e.userId;return function(){var e=Object(g.a)(f.a.mark(function e(a){var n,r;return f.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a({type:"FETCH_ROOM_START"}),e.next=3,S.get("/room?user=".concat(t),{withCredentials:!0});case 3:if("ERROR"!==(n=e.sent).data.status){e.next=6;break}return e.abrupt("return",console.log(n.data.message));case 6:r=n.data.room,a({type:"FETCH_ROOM_SUCCESS"}),a(C({room:r}));case 9:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}({userId:a}))}}})(B()()(Q)),$=a(449),ee=a(453),te=a(446),ae=a(450),ne=a(444),re=a(447),oe=function(e){var t={},a=e.email,n=e.password,r=e.eqpassword;return a?/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,4}$/i.test(e.email)||(t.email="Invalid email address"):t.email="Required",n?n.length<6&&(t.password="Must be 6 characters or more!"):t.password="Required",void 0===r||r?n!==r&&(t.eqpassword="Must be equal to password!"):t.eqpassword="Required",t},ie=a(452),se=a(74),ce=a.n(se),le=a(445),ue=a(111),me=a(448),de=a(137),pe=a.n(de),he=a(139),fe=a.n(he),ge=a(82),Ee=a.n(ge),_e=a(138),ve=a.n(_e),Se=a(114),Oe=a.n(Se),be=function(e){var t=e.input,a=e.label,n=e.meta,o=n.touched,i=n.error,s=Object(ue.a)(e,["input","label","meta"]),c=o&&!!i;return r.a.createElement(pe.a,{className:Oe.a.FormGroup,error:c,"aria-describedby":"component-error-text"},r.a.createElement(ve.a,null,a),r.a.createElement(Ee.a,Object.assign({},t,s)),c?r.a.createElement(fe.a,{className:Oe.a.Error},i):null)},Ie=function(e){var t=e.name,a=e.type,n=e.label;return r.a.createElement("div",{className:Oe.a.InputWrap},r.a.createElement(me.a,{name:t,type:a,component:be,label:n}))},Re=function(e){function t(){var e,a;Object(l.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(m.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).submit=function(){var e=Object(g.a)(f.a.mark(function e(t){var n,r,o,i;return f.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.email,r=t.password,o=a.props.authType,e.next=4,S.post("/".concat(o),{email:n,password:r});case 4:if("ERROR"!==(i=e.sent).data.status){e.next=9;break}i.data.errors.map(function(e){throw new ne.a(e)}),e.next=10;break;case 9:return e.abrupt("return",i.data.payload);case 10:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),a}return Object(p.a)(t,e),Object(u.a)(t,[{key:"componentDidUpdate",value:function(){var e=this.props,t=e.initialized,a=e.authType,n=e.logout,r=e.history;t&&r.push("/"),"logout"===a&&n(function(){R&&R.disconnect(),r.replace("/login")})}},{key:"render",value:function(){var e=this.props,t=e.error,a=e.handleSubmit,n=e.submitting,o="login"===e.authType;return r.a.createElement("div",{className:ce.a.Auth},t&&r.a.createElement("p",{className:ce.a.Error},t),r.a.createElement("form",{onSubmit:a(this.submit),autoComplete:"off"},r.a.createElement(Ie,{name:"email",type:"email",label:"Email"}),r.a.createElement(Ie,{name:"password",type:"password",label:"Password"}),o?null:r.a.createElement(Ie,{name:"eqpassword",type:"password",label:"Repeat password"}),r.a.createElement("div",{className:ce.a.Buttons},r.a.createElement(x.a,{variant:"contained",type:"submit",color:"primary",disabled:n},o?"Log In":"Sign In"),o?r.a.createElement(le.a,{to:"/signin",className:ce.a.Switch},"Sign In"):r.a.createElement(le.a,{to:"/login",className:ce.a.Switch},"Log In"))))}}]),t}(n.Component),Ce=Object(re.a)({form:"auth",validate:oe,onSubmitSuccess:function(e,t){t(O(e))}})(Object(ie.a)(Object(c.b)(function(e){return{initialized:e.auth.initialized}},function(e){return{logout:function(t){return e(function(e){return function(){var t=Object(g.a)(f.a.mark(function t(a){return f.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:a({type:"LOGOUT_START"}),S.get("/logout",{withCredentials:!0}),e(),a({type:"LOGOUT_SUCCESS"});case 4:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()}(t))}}})(Re))),ye=a(217),we=a(206),je=a.n(we),Te=a(98),Ae=a.n(Te),xe=a(207),ke=a.n(xe),Ne=a(116),Me=a.n(Ne);var Pe=function(e){function t(){var e,a;Object(l.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(m.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={suggestions:[],loading:!1},a.fetchSuggestions=function(){var e=Object(g.a)(f.a.mark(function e(t){var n,r,o;return f.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.target.value){e.next=3;break}return e.abrupt("return");case 3:return a.setState({loading:!0}),e.next=6,S.get("/users?q=".concat(n));case 6:r=e.sent,o=r.data.suggestions,a.setState({suggestions:o,loading:!1});case 9:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),a.handleChange=function(e,t){if(e){var n=e.id;a.props.fetchUserProfile(n)}t.clearSelection()},a}return Object(p.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:Me.a.Search},r.a.createElement(ye.a,{onChange:this.handleChange,itemToString:function(e){return e?e.label:""}},function(t){var a=t.getInputProps,n=t.getItemProps,o=t.getMenuProps,i=t.highlightedIndex,s=t.isOpen,c=t.selectedItem;return r.a.createElement("div",{className:Me.a.Autocomplete},function(e){var t=e.InputProps,a=(e.classes,e.ref),n=Object(ue.a)(e,["InputProps","classes","ref"]);return r.a.createElement(je.a,Object.assign({InputProps:Object(E.a)({inputRef:a},t)},n))}({fullWidth:!0,InputProps:a({placeholder:"Search...",onChange:e.fetchSuggestions})}),r.a.createElement("div",o(),s?r.a.createElement(Ae.a,{square:!0,className:Me.a.Suggestions},e.state.loading&&!e.state.suggestions.length?"Loading...":e.state.suggestions.map(function(e,t){return function(e){var t=e.suggestion,a=e.index,n=e.itemProps,o=e.highlightedIndex===a;return r.a.createElement(ke.a,Object.assign({},n,{key:t.id,selected:o,component:"div"}),t.label)}({suggestion:e,index:t,itemProps:n({item:e}),highlightedIndex:i,selectedItem:c})})):null))}))}}]),t}(r.a.Component),Le=Object(c.b)(null,function(e){return{fetchUserProfile:function(t){return e(W(t))}}})(Pe),Ue=a(117),ze=a.n(Ue),Fe=function(e){var t=e.roomName,a=e.click,n=e.active,o=e.notRead,i=[ze.a.Item];return n&&i.push(ze.a.Active),r.a.createElement("div",{className:i.join(" "),onClick:a},r.a.createElement("p",null,t),o&&o.length?r.a.createElement("span",{className:ze.a.NotRead},o.length):null)},De=Object(c.b)(function(e){return{loading:e.chat.roomsLoading,rooms:e.chat.rooms,activeRoomIndex:e.chat.activeRoomIndex}},function(e){return{openRoom:function(t){var a=t.index;return e(w({index:a}))}}})(function(e){var t=e.loading,a=e.rooms,o=e.openRoom,i=e.activeRoomIndex,s=a.map(function(e,t){var a=e.roomType,n=e.users,s=e.notRead,c="";return"dialog"===a&&(c=n.filter(function(e){return!e.owner})[0].email),r.a.createElement(Fe,{active:i===t,key:t,roomName:c,notRead:s,click:function(){return o({index:t})}})});return t&&(s=r.a.createElement(J,null)),r.a.createElement(n.Fragment,null,s)}),He=a(208),qe=a.n(He),Ge=function(){return r.a.createElement("div",{className:qe.a.Sidebar},r.a.createElement(Le,null),r.a.createElement(De,null))},Be=a(39),We=a.n(Be),Ze=a(209),Ke=a.n(Ze),Ye=function(e){var t=e.data,a=e.sameUser,n=e.notRead,o=[We.a.Message];t.owner.owner&&o.push(We.a.IsOwner),n&&o.push(We.a.NotReadBlock);var i=[We.a.Status];switch(t.status){case"not-read":i.push(We.a.NotRead);break;case"sending":i.push(We.a.Sending);break;default:i=null}return r.a.createElement("div",{className:o.join(" ")},!a&&r.a.createElement("div",{className:We.a.Owner},r.a.createElement("p",null,t.owner.email)),r.a.createElement("div",{className:We.a.Body},t.owner.owner&&i?r.a.createElement("span",{className:i.join(" ")}):null,r.a.createElement("div",{className:We.a.Content},t.content),r.a.createElement("p",{className:We.a.Time},Ke()(t.createdAt).format("HH:mm:ss"))))},Xe=a(210),Je=a.n(Xe),Qe=(a(433),a(211)),Ve=a.n(Qe),$e=function(e){function t(){var e,a;Object(l.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(m.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).scrolledUp=!1,a.handleScrolledToTop=function(){a.scrolledUp=!0},a}return Object(p.a)(t,e),Object(u.a)(t,[{key:"componentDidUpdate",value:function(){this.roomBody.scrollTop=this.roomBody.scrollHeight}},{key:"render",value:function(){var e=this,t=this.props,a=t.loading,n=t.messagesLoading,o=t.messages,i=void 0===o?[]:o,s=t.notRead,c=void 0===s?[]:s;return i=i.map(function(e,t){var a=!1;return t>0&&(i[t-1].owner._id===e.owner._id||i[t-1].owner.owner===e.owner.owner)&&(a=!0),r.a.createElement(Ye,{key:e._id||e.uniqId,notRead:c.includes(e._id),sameUser:a,data:e})}),r.a.createElement(Ve.a,{containerRef:function(t){return e.roomBody=t},className:Je.a.Room,onScrollUp:this.handleScrolledToTop},a||n?r.a.createElement(J,null):null,i)}}]),t}(n.Component),et=Object(c.b)(function(e){return{loading:e.chat.roomLoading,messagesLoading:e.chat.messagesLoading,messages:e.chat.rooms[e.chat.activeRoomIndex].messages,notRead:e.chat.rooms[e.chat.activeRoomIndex].notRead}})($e),tt=a(84),at=a.n(tt),nt=a(218),rt=a(212),ot=a.n(rt),it=function(e){function t(){var e,a;Object(l.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(m.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={message:""},a.handleChange=function(e){a.setState({message:e.target.value})},a.handleEnterPress=function(e){"Enter"!==e.key||e.ctrlKey||(e.preventDefault(),a.handleSendMessage())},a.handleCtrlEnterPress=function(e){"Enter"===e.key&&e.ctrlKey&&(e.preventDefault(),a.setState(function(e){return Object(E.a)({},e,{message:e.message+"\n"})}))},a.handleSendMessage=function(){if(a.state.message){var e={type:"text",content:a.state.message,createdAt:new Date,status:"sending"};a.props.send({uniqId:ot()(),message:e}),a.setState({message:""})}},a}return Object(p.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){return r.a.createElement("div",{className:at.a.Container},r.a.createElement("div",{className:at.a.InputWrapper},r.a.createElement(nt.a,{placeholder:"Type here...",onChange:this.handleChange,className:at.a.Input,value:this.state.message,onKeyUp:this.handleCtrlEnterPress,onKeyPress:this.handleEnterPress}),this.state.message?r.a.createElement("button",{className:at.a.Button,onClick:this.handleSendMessage},"Send"):null))}}]),t}(n.Component),st=Object(c.b)(null,function(e){return{send:function(t){var a=t.message,n=t.uniqId;return e(function(e){var t=e.uniqId,a=e.message;return function(e,n){var r=n(),o=r.chat.activeRoomIndex,i=r.auth,s=i.email,c=i.avatar,l=r.chat.rooms[o]._id;a.owner={email:s,avatar:c,owner:!0},e(function(e){var t=e.uniqId;return{type:"SEND_MESSAGE_START",message:e.message,uniqId:t}}({uniqId:t,message:a})),R.emit("message",{uniqId:t,message:Object(E.a)({},a,{room:l})})}}({message:a,uniqId:n}))}}})(it),ct=a(142),lt=a.n(ct),ut=Object(c.b)(function(e){return{activeRoomIndex:e.chat.activeRoomIndex}})(function(e){var t=e.activeRoomIndex;return r.a.createElement("div",{className:lt.a.Container},void 0!==t?r.a.createElement(n.Fragment,null,r.a.createElement(et,null),r.a.createElement(st,null)):r.a.createElement("p",{className:lt.a.Preview},"Please select a chat to start messaging"))}),mt=a(213),dt=a.n(mt),pt=function(e){function t(){return Object(l.a)(this,t),Object(m.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){this.props.fetchUserRooms()}},{key:"componentDidUpdate",value:function(){this.props.failed&&this.props.history.replace("/login")}},{key:"render",value:function(){return r.a.createElement("div",{className:dt.a.Body},r.a.createElement(Ge,null),r.a.createElement(ut,null))}}]),t}(n.Component),ht=Object(ie.a)(Object(c.b)(function(e){return{failed:e.auth.failed}},function(e){return{fetchUserRooms:function(){return e(function(){var e=Object(g.a)(f.a.mark(function e(t,a){var n,r,o,i;return f.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t({type:"FETCH_ROOMS_START"}),n=a().auth.notReadMessages,r={},n&&n.forEach(function(e){var t=r[e.roomId];t?t.push(e.messageId):r[e.roomId]=[e.messageId]}),e.next=6,S.get("/rooms",{withCredentials:!0});case 6:if("ERROR"!==(o=e.sent).data.status){e.next=9;break}return e.abrupt("return",console.log(o.data.message));case 9:(i=o.data.rooms).forEach(function(e){e._id in r&&(e.notRead=r[e._id])}),t({type:"FETCH_ROOMS_SUCCESS",rooms:{rooms:i}.rooms});case 12:case"end":return e.stop()}},e,this)}));return function(t,a){return e.apply(this,arguments)}}())}}})(pt)),ft=a(143),gt=a.n(ft),Et=a(118),_t=a.n(Et),vt=a(214),St=function(e){function t(){var e,a;Object(l.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(m.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={show:!1},a.handleClick=function(){a.setState({show:!0})},a.handleClickOutside=function(){a.setState({show:!1})},a}return Object(p.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.props.email;return r.a.createElement("div",{className:_t.a.Profile},r.a.createElement("p",{onClick:this.handleClick,className:this.state.show?_t.a.active:null},e),this.state.show?r.a.createElement("ul",{className:_t.a.Menu},r.a.createElement("li",null,r.a.createElement(le.a,{to:"/logout"},"logout"))):null)}}]),t}(n.Component),Ot=Object(c.b)(function(e){return{email:e.auth.email,avatar:e.auth.avatar,initialized:e.auth.initialized}})(Object(vt.a)(St)),bt=a(215),It=a.n(bt),Rt=Object(c.b)(function(e){return{initializing:e.auth.initializing,initialized:e.auth.initialized}})(function(e){var t=e.initialized;return r.a.createElement("header",{className:It.a.Header},r.a.createElement("h1",null,"Sociable"),t?r.a.createElement(Ot,null):null)}),Ct=function(e){return r.a.createElement("div",{className:gt.a.Wrapper},r.a.createElement("div",{className:gt.a.App},r.a.createElement(Rt,null),e.children))},yt=function(e){function t(){var e,a;Object(l.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(m.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={errors:[]},a}return Object(p.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){this.props.initialize()}},{key:"componentDidUpdate",value:function(){this.props.initialized&&!this.props.socketInitialized&&this.props.initializeSocket()}},{key:"render",value:function(){var e=this.props,t=e.error,a=e.showPopup,n=e.initialized,o=e.initializing;return r.a.createElement($.a,null,r.a.createElement(Ct,null,t?r.a.createElement(z,{error:!0,message:"Initializing error. Server."}):null,a?r.a.createElement(V,null):null,this.state.errors.map(function(e){return r.a.createElement("div",null,e)}),r.a.createElement(ee.a,null,r.a.createElement(te.a,{path:"/",exact:!0,render:function(){return!o&&n?r.a.createElement(ht,null):o||n?r.a.createElement(J,null):r.a.createElement(ae.a,{to:"/login"})}}),r.a.createElement(te.a,{path:"/login",render:function(){return r.a.createElement(Ce,{authType:"login"})}}),r.a.createElement(te.a,{path:"/signin",render:function(){return r.a.createElement(Ce,{authType:"signin"})}}),r.a.createElement(te.a,{path:"/logout",render:function(){return r.a.createElement(Ce,{authType:"logout"})}}),r.a.createElement(te.a,{path:"/",render:function(){return r.a.createElement("h1",null,"404")}}))))}}]),t}(n.Component),wt=Object(c.b)(function(e){var t=e.auth,a=t.email,n=t.avatar,r=t.error,o=t.initialized;return{initializing:t.initializing,initialized:o,socketInitialized:e.chat.socketInitialized,email:a,avatar:n,error:r,showPopup:e.profile.showPopup}},function(e){return{initialize:function(){return e(function(){var e=Object(g.a)(f.a.mark(function e(t){return f.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t({type:"INITIALIZE_START"}),S.post("/initialize",{withCredentials:!0}).then(function(e){if("OK"!==e.data.status)return t({type:"INITIALIZE_FAILED"});t(O(e.data.payload))}).catch(function(e){return t({type:"INITIALIZE_ERROR",error:{error:e}.error})});case 2:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}())},initializeSocket:function(){return e(function(e,t){(R=I()("/")).on("connect",function(){console.log("connected"),e({type:"SOCKET_INIT_SUCCESS"})}),R.on("message was read",function(t){var a=t.messages;e({type:"MESSAGES_WAS_READ",messages:a})}),R.on("message saved",function(t){var a,n=t.uniqId,r=t.message;e({type:"SEND_MESSAGE_SUCCESS",message:(a={uniqId:n,message:r}).message,uniqId:a.uniqId})}),R.on("message",function(a){var n,r=t().chat,o=r.rooms,i=r.activeRoomIndex,s=!1,c=!1,l=a.room;o.forEach(function(e,t){e._id===l._id&&(c=!0,n=t)}),c||(void 0!==o?o.push(l):o=l,n=o.length-1);var u=o[n],m=u.messages;m&&m.push(a),a.owner.owner||(u.notRead?u.notRead.push(a._id):u.notRead=[a._id]),n===i&&(s=!0),e({type:"PUSHED_MESSAGE",rooms:o}),s&&e(y({activeRoomIndex:i}))})})}}})(yt),jt=a(216),Tt={email:"",avatar:"",notReadMessages:[],initializing:!0,initialized:!1,failed:!1,error:null},At=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Tt,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"LOGOUT_START":return e;case"LOGOUT_SUCCESS":return Object(E.a)({},Tt,{failed:!0});case"INITIALIZE_START":return Object(E.a)({},e,{initializing:!0});case"INITIALIZE_SUCCESS":var a=t.email,n=t.avatar,r=t.notReadMessages;return Object(E.a)({},e,{email:a,avatar:n,notReadMessages:r,initializing:!1,initialized:!0,failed:!1});case"INITIALIZE_FAILED":return Object(E.a)({},e,{initialized:!1,initializing:!1,failed:!0});case"INITIALIZE_ERROR":return Object(E.a)({},e,{initializing:!1,initialized:!1,error:t.error});default:return e}},xt=a(451),kt={info:{avatar:null,email:"",id:null,room:null},showPopup:!1,fetching:!1,error:null},Nt=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:kt,t=arguments.length>1?arguments[1]:void 0,a=t.info,n=t.error;switch(t.type){case"LOGOUT_SUCCESS":return kt;case"FETCH_PROFILE_START":return Object(E.a)({},e,{fetching:!0,showPopup:!0});case"FETCH_PROFILE_SUCCESS":return Object(E.a)({},e,{fetching:!1,info:a});case"FETCH_PROFILE_ERROR":return Object(E.a)({},e,{fetching:!1,error:n});case"CLOSE_PROFILE":return Object(E.a)({},e,{showPopup:!1});default:return e}},Mt=a(144),Pt=a(29),Lt=a.n(Pt),Ut={rooms:[],activeRoomIndex:void 0,roomsLoading:!1,roomLoading:!1,messagesLoading:!1,socketInitialized:!1},zt=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ut,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"LOGOUT_SUCCESS":return Ut;case"FETCH_ROOM_START":return Object(E.a)({},Lt.a.cloneDeep(e),{roomLoading:!0});case"FETCH_ROOM_SUCCESS":case"FETCH_ROOM_ERROR":return Object(E.a)({},Lt.a.cloneDeep(e),{roomLoading:!1});case"FETCH_ROOMS_START":return Object(E.a)({},Lt.a.cloneDeep(e),{roomsLoading:!0});case"FETCH_ROOMS_SUCCESS":return Object(E.a)({},Lt.a.cloneDeep(e),{roomsLoading:!1,rooms:t.rooms});case"FETCH_ROOMS_ERROR":return Object(E.a)({},Lt.a.cloneDeep(e),{roomsLoading:!1});case"OPEN_ROOM":return Object(E.a)({},Lt.a.cloneDeep(e),{activeRoomIndex:t.activeRoomIndex});case"CREATE_ROOM":return Object(E.a)({},Lt.a.cloneDeep(e),{rooms:[t.room].concat(Object(Mt.a)(e.rooms)),activeRoomIndex:0});case"FETCH_MESSAGES_START":return Object(E.a)({},Lt.a.cloneDeep(e),{messagesLoading:!0});case"FETCH_MESSAGES_SUCCESS":var a=Lt.a.cloneDeep(e);return a.rooms[e.activeRoomIndex].messages=t.messages,a.messagesLoading=!1,a;case"SEND_MESSAGE_START":var n=Lt.a.cloneDeep(e),r=t.message,o=t.uniqId;return r.uniqId=o,n.rooms[e.activeRoomIndex].messages?n.rooms[e.activeRoomIndex].messages.push(r):n.rooms[e.activeRoomIndex].messages=[r],n;case"SEND_MESSAGE_SUCCESS":var i=t.message,s=t.uniqId,c=Lt.a.cloneDeep(e);try{c.rooms.forEach(function(e,t){e.messages&&e.messages.forEach(function(e,a){if(e.uniqId===s)throw i.owner=e.owner,c.rooms[t].messages[a]=i,new Error("break loop")})})}catch(f){if("break loop"!==f.message)throw f}return c;case"SOCKET_INIT_SUCCESS":return Object(E.a)({},e,{socketInitialized:!0});case"PUSHED_MESSAGE":var l=Lt.a.cloneDeep(e),u=Lt.a.cloneDeep(t.rooms);return Object(E.a)({},l,{rooms:Object(Mt.a)(u)});case"READ_MESSAGES":var m=Lt.a.cloneDeep(e),d=t.activeRoomIndex;return m.rooms[d].notRead=[],m;case"MESSAGES_WAS_READ":var p=Lt.a.cloneDeep(e),h=t.messages;return p.rooms.forEach(function(e){e.messages&&e.messages.forEach(function(e){h.includes(e._id)&&(e.status="read")})}),p;default:return e}},Ft=Object(s.c)({auth:At,form:xt.a,profile:Nt,chat:zt}),Dt=s.d;window.__MUI_USE_NEXT_TYPOGRAPHY_VARIANTS__=!0;var Ht=Object(s.e)(Ft,Dt(Object(s.a)(jt.a))),qt=r.a.createElement(c.a,{store:Ht},r.a.createElement(wt,null));i.a.render(qt,document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})},74:function(e,t,a){e.exports={Auth:"Auth_Auth__2bc43",Error:"Auth_Error__2PM-K",Buttons:"Auth_Buttons__3LABR",Switch:"Auth_Switch__3Qum1"}},84:function(e,t,a){e.exports={Container:"MessageInput_Container__2FIuU",Input:"MessageInput_Input__1nz7Z",InputWrapper:"MessageInput_InputWrapper__1erff",Placeholder:"MessageInput_Placeholder__-AMGB"}}},[[219,2,1]]]);
//# sourceMappingURL=main.0452c5e3.chunk.js.map